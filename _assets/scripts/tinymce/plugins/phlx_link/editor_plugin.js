(function(){tinymce.create("tinymce.plugins.PhlexibleLinkPlugin",{init:function(a,b){this.editor=a;a.addCommand("mcePhlxLink",function(){var g=a.selection;if(g.isCollapsed()&&!a.dom.getParent(g.getNode(),"A")){return}var j=this.selection.getNode();j=this.dom.getParent(j,"A");var i=this.dom.getAttrib(j,"target")||"";var e=this.dom.getAttrib(j,"href")||"";var d=this.dom.getAttrib(j,"class")||"";var h=false;if(e){var c=e.match(/\[tid.([0-9]*)\]/);if(c){e=c[1];h=true}}var f=getClasses(a);a.windowManager.open({items:{xtype:"form",bodyStyle:"padding: 5px;",border:false,items:[{html:"Start typing to search for a link target or click the icon to open the link editor.",border:false,bodyStyle:"padding-bottom: 10px;"},{xtype:"linkfield",fieldLabel:"Source element",allSiteroots:true,labelSeparator:"",siteroot_id:a.settings.phlx_element.siteroot_id,language:a.settings.phlx_element.language,allowed:{tid:true,intrasiteroot:true,url:true,mailto:true},hideNewWindow:true,hideLanguage:true,anchor:"-70",listWidth:233,treeWidth:233,menuConfig:{width:250},value:e,hiddenValue:h?"id:"+e:e,listeners:{render:function(k){if(!h){return}Ext.Ajax.request({url:Phlexible.baseUrl+"/tinymce/data/link/tid/"+e,success:function(m){var l=Ext.decode(m.responseText);if(l.success){k.setValue(l.data.title)}},scope:k})}}},{xtype:"twincombobox",fieldLabel:"Target",emptyText:"No target",store:new Ext.data.SimpleStore({fields:["value"],data:[["_blank"],["_self"]],id:0}),anchor:"-70",listWidth:233,displayField:"value",mode:"local",forceSelection:true,typeAhead:false,editable:false,triggerAction:"all",selectOnFocus:true,value:i},{xtype:"twincombobox",hiddenName:"cls",fieldLabel:"Class",emptyText:"No class",store:new Ext.data.SimpleStore({fields:["key","value"],data:f,id:0}),anchor:"-70",listWidth:233,displayField:"value",valueField:"key",mode:"local",forceSelection:true,typeAhead:false,editable:false,triggerAction:"all",selectOnFocus:true,value:d}],buttons:[{text:"Cancel",handler:function(k){var l=k.ownerCt.ownerCt;l.close()},scope:this},{text:"Set",handler:function(m){var p=this;var s,n,o;s=p.selection.getNode();s=p.dom.getParent(s,"A");var l=m.ownerCt;var k=l.getComponent(1).hiddenValue;var r=l.getComponent(2).getValue();var t=l.getComponent(3).getValue();var q=l.ownerCt;if(k.substr(0,3)=="id:"){k="[tid:"+k.substr(3)+"]"}else{if(k.substr(0,3)=="sr:"){k="[tid:"+k.substr(3)+"]"}}if(!k){o=p.selection.getBookmark();p.dom.remove(s,1);p.selection.moveToBookmark(o);tinymce.execCommand("mceEndUndoLevel");q.close();return}if(s==null){p.getDoc().execCommand("unlink",false,null);tinymce.execCommand("mceInsertLink",false,"#mce_temp_url#",{skip_undo:1});n=tinymce.grep(p.dom.select("a"),function(u){return p.dom.getAttrib(u,"href")=="#mce_temp_url#"});for(o=0;o<n.length;o++){setAllAttribs(s=n[o],k,r,t,p)}}else{setAllAttribs(s,k,r,t,p)}if(s.childNodes.length!=1||s.firstChild.nodeName!="IMG"){p.focus();p.selection.select(s);p.selection.collapse(0)}tinymce.execCommand("mceEndUndoLevel");q.close()},scope:this}]},name:"Link",width:480,height:200,inline:1},{plugin_url:b})});a.addButton("link",{title:"advlink.link_desc",cmd:"mcePhlxLink"});a.addShortcut("ctrl+k","advlink.advlink_desc","mcePhlxLink");a.onNodeChange.add(function(d,c,f,e){c.setDisabled("link",e&&f.nodeName!="A");c.setActive("link",f.nodeName=="A"&&!f.name)})},getInfo:function(){return{longname:"Phlexible link",author:"Stephan Wentz",authorurl:"http://phlexible.net",infourl:"http://phlexible.net",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("phlx_link",tinymce.plugins.PhlexibleLinkPlugin)})();function setAllAttribs(g,d,e,b,c){var a=tinymce.settings.url_converter;var f=tinymce.settings.convert_urls;tinymce.settings.url_converter=null;tinymce.settings.convert_urls=0;setAttrib(g,"href",d,c);setAttrib(g,"target",e=="_self"?"":e,c);setAttrib(g,"class",b,c);tinymce.settings.url_converter=a;tinymce.settings.convert_urls=f;if(tinyMCE.isMSIE5){g.outerHTML=g.outerHTML}}function setAttrib(e,c,b,a){var d=a.dom;if(typeof(b)=="undefined"||b==null){b=""}d.setAttrib(e,c,b)}function getClasses(a){var c=a.settings.advlink_styles;var d=[];if(c){var f=c.split(";");for(var b=0;b<f.length;b++){if(f!=""){var e=f[b].split("=");d.push([e[1],e[0]])}}}return d};